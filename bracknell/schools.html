---
title: Eco Rewards - Rewarding Green Travel Choices
description: Earn reward points for making greener travel choices
layout: default
anchorLinks: false
registrationLink: "#registration"
---

<div class="album py-5 bg-light">
  <div class="container">

    <div class="row justify-content-md-center">
      <div class="card shadow-sm school-image-sm mt-3 text-left col-sm-2">
        <div class="card-body">
          <div class="post-image" style="background: url(/assets/image/orgs/epcs-rev.png) center no-repeat; background-size: 80px"></div>
          <div class="text-center">Easthampstead Park CS</div>
        </div>
      </div>

      <div class="card shadow-sm school-image-sm mt-3 text-left col-sm-2">
        <div class="card-body">
          <div class="post-image" style="background: url(/assets/image/orgs/ghc.png) center no-repeat; background-size: 80px"></div>
          <div class="text-center">Garth Hill College</div>
        </div>
      </div>

      <div class="card shadow-sm school-image-sm mt-3 text-left col-sm-2">
        <div class="card-body">
          <div class="post-image" style="background: url(/assets/image/orgs/warfield.png) center no-repeat; background-size: 80px"></div>
          <div class="text-center">Warfield Primary</div>
        </div>
      </div>

      <div class="card shadow-sm school-image-sm mt-3 text-left col-sm-2">
        <div class="card-body">
          <div class="post-image" style="background: url(/assets/image/orgs/st-michaels.png) center no-repeat; background-size: 80px"></div>
          <div class="text-center">St Michaels Primary</div>
        </div>
      </div>
    </div>

    <div class="row justify-content-md-center">

      <div class="card shadow-sm school-image-sm mt-3 text-left col-sm-2">
        <div class="card-body">
          <div class="post-image" style="background: url(/assets/image/orgs/kings.png) center no-repeat; background-size: 80px"></div>
          <div class="text-center">Kings Academy</div>
        </div>
      </div>

      <div class="card shadow-sm school-image-sm mt-3 text-left col-sm-2">
        <div class="card-body">
          <div class="post-image" style="background: url(/assets/image/orgs/harmans.png) center no-repeat; background-size: 80px"></div>
          <div class="text-center">Harmans Water Primary</div>
        </div>
      </div>

      <div class="card shadow-sm school-image-sm mt-3 text-left col-sm-2">
        <div class="card-body">
          <div class="post-image" style="background: url(/assets/image/orgs/ranelagh.png) center no-repeat; background-size: 80px"></div>
          <div class="text-center">Ranelagh School</div>
        </div>
      </div>

      <div class="card shadow-sm school-image-sm mt-3 text-left col-sm-2">
        <div class="card-body">
          <div class="post-image" style="background: url(/assets/image/orgs/st-josephs.png) center no-repeat; background-size: 80px"></div>
          <div class="text-center">St Josephs Primary</div>
        </div>
      </div>

    </div>

    <div class="row justify-content-md-center">
      <div class="col-md-8">
        <div class="row">
          <div class="col text-center">
            <div class="btn-group btn-group-toggle mb-2" data-toggle="buttons">
              <label class="btn btn-secondary active">
                <input type="radio" name="chartToggle" value="#rewardChart" autocomplete="off" checked> Points
              </label>
              <label class="btn btn-secondary">
                <input type="radio" name="chartToggle" value="#carbonSavingChart" autocomplete="off"> Carbon Saving
              </label>
              <label class="btn btn-secondary">
                <input type="radio" name="chartToggle" value="#milesChart" autocomplete="off"> Green Miles
              </label>
            </div>
          </div>
        </div>

        <canvas id="rewardChart" width="400" height="240"></canvas>
        <canvas style="display: none" id="carbonSavingChart" width="400" height="240"></canvas>
        <canvas style="display: none" id="milesChart" width="400" height="240"></canvas>

        <div class="row mt-5">
          <table class="table table-striped">
            <thead>
            <tr>
              <th>Participating Schools</th>
              <th class="text-right">Points</th>
              <th class="text-right">Carbon Saving</th>
              <th class="text-right">Green Miles</th>
            </tr>
            </thead>
            <tbody id="dataTable">

            </tbody>
          </table>
          <p class="tableStartDate">Totals for each school since 1st June 2021</p>
        </div>

        <h2 id="registration" class="heading heading--md heading--color-1 mt-5">Registration</h2>
        <div class="form-group">
          <label for="memberId">Member ID:</label>
          <input type="text" class="form-control text-muted" id="memberId" pattern="^[.0-9]*$"/>
        </div>

        <div class="form-group">
          <label for="organisation">Select your school:</label>
          <select class="form-control text-muted" id="organisation" name="organisation">
            <option value="">Please select</option>
            <option value="/organisation/2">Easthampstead Park CS</option>
            <option value="/organisation/3">Garth Hill College</option>
            <option value="/organisation/12">Warfield Primary</option>
            <option value="/organisation/15">Kings Academy Secondary</option>
            <option value="/organisation/16">Kings Academy Primary</option>
            <option value="/organisation/14">Harmans Water Primary</option>
            <option value="/organisation/13">St Michaels Primary</option>
            <option value="/organisation/19">Ranelagh School</option>
            <option value="/organisation/17">St Josephs Primary</option>
          </select>
        </div>

        <div class="form-group">
          <label for="memberGroup">Select your group:</label>
          <select class="form-control text-muted" id="memberGroup" name="memberGroup">
          </select>
        </div>

        <button id="submit" type="button" class="btn btn-primary" disabled>Continue</button>

      </div>
      <div class="col-md-8">
        <h2 class="heading heading--md heading--color-1 mt-5">Links</h2>
        <p>
          <a class="btn-primary btn" style="color: white;" href="/selfreport">Self Reporting</a>
          <a class="btn-primary btn" style="color: white;" href="https://www.ecorewards.org.uk/">Eco Rewards Website</a>
        </p>
      </div>
    </div>
  </div>
</div>

{% include modal.html %}
{% include footer.html %}
<script src="https://code.jquery.com/jquery-3.4.1.min.js" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js@2.9.3/dist/Chart.min.js" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js" integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous"></script>
<script src="{{ site.baseurl }}/assets/js/script.js"></script>
<script type="application/javascript">

  $(document).ready(() => {
    $("#organisation").change(function() {
      const val = $(this).val();
      $("#memberGroup").html('');
      if (val.startsWith("/organisation/")) {
        $.get("https://api.ecorewards.co.uk/groups", response => {
          response.data
            .filter(group => group.organisation === val)
            .map(group => $('<option>').val(group.id).text(group.name))
            .forEach(option => option.appendTo('#memberGroup'));
        });
      }
    });

    $("input[name=chartToggle]").click(function() {
      $("canvas").css({ display: "none"});
      $($(this).val()).css({ display: "block" });
    });

    function toggleButton() {
      $("#submit").attr("disabled", $("#memberGroup").val() == null || $("#memberGroup").val().length < 1 || $("#memberId").val().length < 10);
    }

    $("#memberId").change(toggleButton);
    $("#memberGroup").change(toggleButton);

    $("#submit").on("click", () => {
      const memberId = $("#memberId").val();
      const data = {
        group: $("#memberGroup").val()
      };

      $.ajax({
        url: "https://api.ecorewards.co.uk/member/" + memberId,
        type: "PATCH",
        data: data,
        success: () => {
          window.location = "https://www.ecorewards.org.uk/secure/register.php?memberId=" + memberId
        },
        error: () => {
          alert('Invalid member ID');
        }
      });
    });

    const schools = ["Easthampstead Park CS", "Garth Hill College", "Warfield Primary", "St Michaels Primary", "Kings Academy Secondary", "Kings Academy Primary", "Harmans Water Primary", "Ranelagh School", "St Josephs Primary"]
    const date = new Date();

    // 1st Aug, 1st Nov, 1st Jan, 1st March, 1st April, 1st June
    const monthMap = {
      0: 0,
      1: 0,
      2: 2,
      3: 3,
      4: 3,
      5: 5,
      6: 5,
      7: 7,
      8: 7,
      9: 7,
      10: 10,
      11: 10
    };

    date.setMonth(monthMap[date.getMonth()]);
    date.setDate(1);

    $.get("https://api.ecorewards.co.uk/scheme/6/report?from=" + date.toJSON().substr(0, date.toJSON().indexOf("T")), response => {
      createTable(schools, response);
      const month = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"][date.getMonth()];
      const nth = function(d) {
        if (d > 3 && d < 21) return 'th';
        switch (d % 10) {
          case 1:  return "st";
          case 2:  return "nd";
          case 3:  return "rd";
          default: return "th";
        }
      }

      $(".tableStartDate").html(`Totals for each school since ${date.getDate()}${nth(date.getDate())} ${month} ${date.getFullYear()}`);
    });

    $.get("https://api.ecorewards.co.uk/scheme/6/report" , response => {
      createGraph("rewardChart", "totalRewardsEarned", schools, response);
      createGraph("carbonSavingChart", "totalCarbonSaving", schools, response);
      createGraph("milesChart", "totalDistance", schools, response);
    });
  });

  function createGraph(id, field, schools, response) {
    const ctx = document.getElementById(id).getContext("2d");
    let colourI = 0;
    const colours = ["#4e73df", "#1cc88a", "#f6c23e", "#36b9cc",  "#e74a3b", "#858796", "#ff00ff", "#ff9900", "#674ea7"];
    const datasets = response.data.reduce((index, col) => {
      if (schools.includes(col.name)) {
        index[col.name] = index[col.name] || { data: [], label: col.name, backgroundColor: colours[colourI++ % colours.length] };
        index[col.name].data.push(col[field]);
      }

      return index;
    }, {});
    const labels = response.data.reduce((index, col) => {
      index[col.date] = true;
      return index;
    }, {});
    const myChart = new Chart(ctx, {
      type: 'bar',
      data: {
        labels: Object.keys(labels),
        datasets: Object.values(datasets)
      },
      options: {
        scales: {
          yAxes: [{
            ticks: {
              beginAtZero: true
            }
          }]
        }
      }
    });
  }

  function createTable(schools, response) {
    const schoolData = response.data.reduce((index, col) => {
      index[col.name] = index[col.name] || { totalRewardsEarned: 0, totalCarbonSaving: 0, totalDistance: 0 };
      index[col.name].totalRewardsEarned += col.totalRewardsEarned;
      index[col.name].totalCarbonSaving += col.totalCarbonSaving;
      index[col.name].totalDistance += col.totalDistance;

      return index;
    }, {});

    const html = schools
      .sort((a, b) => a.replace("St ", "") > b.replace("St ", ""))
      .filter(school => schoolData[school])
      .map(school => `
        <td>${school}</td>
        <td class="text-right">${schoolData[school].totalRewardsEarned}</td>
        <td class="text-right">${schoolData[school].totalCarbonSaving.toFixed(2)}kg</td>
        <td class="text-right">${schoolData[school].totalDistance.toFixed(2)} miles</td>
      `)
      .reduce((r, row) => r + `<tr>${row}</tr>`, "");

    $("#dataTable").html(html);
  }

</script>
